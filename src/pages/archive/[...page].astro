---
import Layout from '../../layouts/ArchiveLayout.astro';
import CardL from '../../components/cards/CardL.astro';
import Pagination from '../../components/Pagination.astro';

import { getCollection } from "astro:content";
import type { GetStaticPaths } from "astro";

import { sortEntries, sortByCreationDate, sortByUploadDate } from '../../utility/utils.js';

export const getStaticPaths = (async ( { paginate } ) => {
    const entries = await getCollection("entries");
	const sortedEntries = entries.sort(sortByCreationDate).toReversed();
    return paginate(sortedEntries, {
        pageSize: 4,
    })
}) satisfies GetStaticPaths;

const { page } = Astro.props;

const pathname = new URL(Astro.request.url).pathname.split('/');

const firstPath = pathname[1];
---


<Layout title="ARCHIVE">

<main>

	<ul role="list">
		{
			page.data.map((entry) => 
				<CardL
					slug={entry.slug}
					title={entry.data.title}
					date={entry.data.date}
					thumb={entry.data.thumb.src}
					tags={entry.data.tags}
					desc={entry.data.desc}
					original={entry.data.original}
					medium={entry.data.medium}
					Nsfw={entry.data.Nsfw}
					Dd={entry.data.Dd}
					icons={entry.data.icons}
			/>
		)}
	</ul>

	<Pagination 
		firstUrl={`/${firstPath}`}
		prevUrl={page.url.prev} 
		currentPage={page.currentPage}
		currentUrl={page.url.current}
		nextUrl={page.url.next}
		lastUrl={`/${firstPath}/${page.lastPage}`}
	/>

	</main>

</Layout>

<style>

	main {
		margin: auto;
	}

	ul {
		padding: 0;
		margin: 1em;
		max-width: 800px;
	}

	.card-masonry {
		display: grid;
		gap: 1em;
		max-width: 100%;
	}

@media all and (min-width: 700px) {

	.card-masonry {
		grid-template-columns: repeat(2, 1fr);
		gap: 1em;
	}

	ul {
		padding: 0 1em;
		margin: auto;
	}

}

@media all and (min-width: 1000px) {

	.card-masonry {
		grid-template-columns: repeat(3, 1fr);
	}

}

@media all and (min-width: 1200px) {
		
		.card-masonry {
			grid-template-columns: repeat(4, 1fr);
		}
	
	}

</style>
