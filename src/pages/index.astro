---
import Layout from '../layouts/Layout.astro';
import CardL from '../components/CardL.astro';
import CardPreview from '../components/CardPreview.astro';
import Footer from '../components/Footer.astro';
import ArtGallery from '../components/ArtGallery.astro';

import Header from '../components/Header.astro';
import Tags from '../components/ArchiveSidebar.astro';
import Uploads from '../components/Uploads.astro';

import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import { sortByDate } from "../js/utils"

const entries = await getCollection("entries");

function sortByUploadDate(entries) {
    const sort = [...entries];
    // @ts-ignore
    sort.sort((a, b) => new Date(a.data.uploadDate) - new Date(b.data.uploadDate));
    return sort;
}

const sortedEntries = sortByUploadDate(entries).toReversed();

interface Props {
	slug: string;
	title: string;
	thumb: ImageMetadata;
	date: Date;
	Nsfw?: boolean;
	Dd?: boolean;
	classes?: string;
	desc: string;
	medium: string;
	tags: Array<string>;
	original: boolean;
}

const { 
		slug,
		title,
		thumb,
		date,
		Nsfw,
		Dd,
		desc,
		medium,
		original,
		tags,
		} = Astro.props as Props;

---

<Layout title="WORKS">

<Header />

	<main>
		<h1>{title}</h1>
		<p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eaque, et officia doloribus amet quia asperiores sapiente officiis dolorum, facere iure, tenetur hic praesentium.</p>
		<div class="wrapper">
			<h2>RECENT ARCHIVE ENTRIES</h2>
				<div class="card-masonry">
					{ sortedEntries.slice(0, 3).map((entry) =>
						<CardPreview
							slug={entry.slug}
							title={entry.data.title}
							date={entry.data.date}
							thumb={entry.data.thumb.src}
							tags={entry.data.tags}
							desc={entry.data.desc}
							original={entry.data.original}
							medium={entry.data.medium}
							Nsfw={entry.data.Nsfw}
							Dd={entry.data.Dd}
							/>
					)}
				</div>
				<a class="visit" href="">VIEW MORE <i class="fas fa-angles-right"></i></a>

		</div>
		<div class="wrapper">

		<h2>GALLERY</h2>
			<a href="">
				<div class="gallery-grid">
					{ entries.map((entry) =>
							entry.data.gallery &&
							<Image class="thumb"
								src={entry.data.thumb.src}
								alt={`${entry.data.title} thumbnail`}
							/>
					)}
					
				</div>
			</a>
			<a class="visit" href="">VISIT <i class="fas fa-angles-right"></i></a>
		</div>


		<div class="wrapper">
			<h2>PROJECTS</h2>
				{ entries.slice(0, 2).map((entry) =>
					<CardL
						slug={entry.slug}
						title={entry.data.title}
						date={entry.data.date}
						thumb={entry.data.thumb.src}
						tags={entry.data.tags}
						desc={entry.data.desc}
						original={entry.data.original}
						medium={entry.data.medium}
						Nsfw={entry.data.Nsfw}
						Dd={entry.data.Dd}
						icons={entry.data.icons}
						/>
				)}
		</div>

		<!-- <ul role="list" class="card-masonry">
			{
				entries.toReversed().map((entry) => 
				<CardS 
					title={entry.data.title}
					date={entry.data.date}
					thumb={entry.data.thumb.src}
					tags={entry.data.tags}
					medium={entry.data.medium}
					Nsfw={entry.data.Nsfw}
					Dd={entry.data.Dd}
					desc={entry.data.desc}
				/>
			)}
		</ul> -->
	</main>

</Layout>

<style>

	.wrapper {
		margin: auto;
		text-align: center;
	}

	.gallery-grid {
		display: flex;
		flex-direction: row;
		flex-wrap: wrap;
		gap: 1em;
		align-items: center;
		justify-content: center;
		margin: 3em auto;
		max-width: 600px;
	}

	.card-masonry {
		margin: 2em auto;
		display: flex;
		flex-wrap: wrap;
		flex-direction: row;
		justify-content: center;
		align-items: stretch;
		gap: 1.5em;
		height: 100%;
	}

	.thumb {
		max-width: 100px;
		max-height: 100px;
		border-radius: 0.5em;
	}

	.visit {
		margin: auto;
		font-size: 1.5rem;
		text-align: center;
		font-family: var(--display);
		text-decoration: none;
	}

	.visit .fas {
		font-size: 0.8em;
	}

	h1 {
		font-size: 2.5rem;
		font-weight: 700;
		line-height: 1;
		text-align: center;
		margin-bottom: 1em;
	}

	h2 {
		font-size: 2rem;
		font-family: var(--display);
		margin: 1.5em;
		text-align: center;
	}
	
	ul {
		padding: 0;
		margin: 1em;
	}


@media all and (min-width: 700px) {

	 {
	}

}

@media all and (min-width: 1000px) {
		
	main .archive-cards {
	}

}

@media all and (min-width: 1200px) {
		
		.card-masonry {
		}
	
	}

</style>
